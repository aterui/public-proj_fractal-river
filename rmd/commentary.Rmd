---
title: "Mathematical characterization of fractal river networks"
output: 
  bookdown::pdf_document2:
   keep_tex: true
   latex_engine: xelatex
   toc: false
   number_sections: false
fontsize: 12pt
mainfont: "Times New Roman"
knit: (function(inputFile, encoding) {
        rmarkdown::render(inputFile,
                          encoding = encoding, 
                          output_dir = "document_output")
      })
bibliography: references.bib
csl: https://www.zotero.org/styles/population-ecology
header-includes:
  - \usepackage[left]{lineno}
  - \linenumbers
---

```{r setup, include=FALSE}

source(here::here("code/set_rmd.R"))
```

Author: Akira Terui^1,\*^

Email: hanabi0111\@gmail.com

^1^Department of Biology, University of North Carolina at Greensboro, Greensboro, NC 27410, USA

# Abstract

River networks exhibit fractal characteristics. Quantifying river network complexity is crucial for unveiling the role of river fractals in driving riverine ecological dynamics, and researchers have used a metric of "branching probability" to do so. Previous studies showed that this metric reflects the fractal nature of river networks. However, a recent article by @carraroOptimalChannelNetworks2022 contradicted this classical observation and concluded that branching probability is "scale dependent." I dispute this claim and argue that their major conclusion is derived merely from their misconception of scale invariance. Their analysis in the original article (Figure 3a) provided evidence that branching probability is scale invariant (i.e., branching probability exhibits a power-law scaling), although the authors erroneously interpreted this result as a sign of scale dependence. In this paper, I re-introduce the definition of scale invariance and show that branching probability meets this definition. This provided an opportunity to address the distinct use of "scale invariance" and "scaling" in the ecological literature.

# Maintext

Rivers form complex branching networks with fractal characteristics -- "there are basins within basins within basins, all of them looking alike [@rinaldoEvolutionSelectionRiver2014]." The ecological implication of fractal structure has gained great interest over the past few decades [@grantLivingBranchesPopulation2007; @carraraDendriticConnectivityControls2012; @mariMetapopulationPersistenceSpecies2014], and there have been concerted efforts to investigate the role of river fractals in controlling metapopulation [@teruiMetapopulationStabilityBranching2018; @yeakelSynchronisationStabilityRiver2014; @mariMetapopulationPersistenceSpecies2014] and metacommunity dynamics [@teruiEmergentDualScaling2021; @carraraDendriticConnectivityControls2012; @andersonEffectsDispersalRiver2018]. The proper quantification of river network complexity is therefore crucial, and some researchers used a metric of "branching probability," i.e., the probability of observing a joining tributary per unit river distance [@yeakelSynchronisationStabilityRiver2014; @teruiMetapopulationStabilityBranching2018; @teruiEmergentDualScaling2021]. It has been shown that this measure reflects the fractal nature of river networks because it exhibits the sign of scale invariance [@peckhamReformulationHortonLaws1999; @teruiMetapopulationStabilityBranching2018; @rodriguez-iturbeFractalRiverBasins2001]. However, a recent article by @carraroOptimalChannelNetworks2022 countered this classical observation and concluded that branching probability is "scale dependent." They seriously criticized past research [@teruiMetapopulationStabilityBranching2018; @teruiEmergentDualScaling2021; @yeakelSynchronisationStabilityRiver2014; @andersonEffectsDispersalRiver2018] for the use of branching probability as a measure of river fractals, provocatively concluding "*an alleged property of such random networks (branching probability) is a scale dependent quantity that does not reflect any recognized metric of rivers' fractal character...*" in the Abstract. Here, I would like to communicate my concern that their major conclusion is merely a misconception of the term "scale invariance." Indeed, the reanalysis of their data proved that branching probability is scale invariant. In what follows, I re-introduce the definition of scale invariance and show that branching probability meets this definition.

# Premise: the definition of scale invariance

The concept of scale invariance is inherently confusing and is often misunderstood among ecologists. To clarify this concept, let me use the most famous example of a scale invariant object -- the complex structure of the coastline [@mandelbrotHowLongCoast1967]. In Mandelbrot's pioneering work, he measured the coastline length $y$ as multiples of a ruler with unit length $x$ (the "observation scale"). He observed that the length $y$ diverged to reach infinity as $x \rightarrow 0$, because finer but similar zig-zag patterns emerged over and over as he used a shorter ruler (Figure 1); that is, there was no specific scale that uniquely characterizes the coastline length (the "lack of characteristic scale"; Table 1). However, when the coastline length was expressed as a function of scale $x$ ($y = f(x)$), the function obeyed a simple rule that reflects the fractal nature of the observed object: the power law.

$$
\begin{aligned}
y = f(x) = cx^z &&\text{(1),}
\end{aligned}
$$

where $c$ is the scaling constant and $z$ is the scaling exponent. The scale invariance of this function can be easily proved by multiplying an arbitrary scaling factor $\lambda$:

$$
\begin{aligned}
y'=f(\lambda x)=c\lambda^zx^z = \lambda^z f(x) = \lambda^z y  &&\text{(2),}
\end{aligned}
$$

The above equation is interpreted as a sign of scale invariance because the multiplicative extension/shrink of scale $x$ by factor $\lambda$ results in the same shape of the original object $y$ but with a *different scale* [@proektScaleInvarianceDynamics2012] (i.e., the structural property or function is preserved). Hence, the observed object $y$ (= function $f(x)$) is said to be scale invariant.

Although a power law is the most famous example of scale invariance, any function $f(x)$ that suffices the following equation is said to be scale invariant [@rodriguez-iturbeFractalRiverBasins2001; @proektScaleInvarianceDynamics2012]:

$$
\begin{aligned}
f(\lambda x) = \lambda^z f(x) &&\text{(3),}
\end{aligned}
$$

A general property of this function is "scaling" (Table 1), in which the dimensional physical quantity of the object (e.g., length) changes predictably across scale $x$ [@rodriguez-iturbeFractalRiverBasins2001].

Conversely, a "scale dependent" object possesses contrasting properties (Table 1). A square exemplifies a scale dependent object. Assuming $500$ km on a side, the perimeter ($500 \times 4 =2000$ km) remains constant at the divisors of $500$ ($x = 1, 2, 4, 5,...,500$); otherwise, the measured perimeter becomes shorter than the true length if we disregard rulers that do not fit the square's side ($y = x \lfloor \frac{500}{x} \rfloor \times 4$, where $\lfloor \cdot \rfloor$ denotes the integer part of the division; see Figure 1). Therefore, the square has characteristic scales that uniquely identify its physical quantity. This property is called "non-scaling," which contrasts with the property of a scale invariant object [@rodriguez-iturbeFractalRiverBasins2001]. Although I used a square for the sake of simplicity, a more general definition of non-scaling is $f(\lambda x) \ne \lambda^zf(x)$. Thus, "scale dependence" and "scale invariance" are contrasting observations.

| Object type     | Property                                           |
|-----------------|----------------------------------------------------|
| Scale invariant | Scaling, the lack of characteristic scale          |
| Scale dependent | Non-scaling, the existence of characteristic scale |

: Key terminology

```{r example, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=4, fig.cap="Graphical comparison of scale invariant and scale dependent objects. Black lines indicate an example of a scale invariant object (coastline), while gray lines show an example of a scale dependent object (square). For the square, the solid gray lines indicate the measured length as multiples of the integer ruler length $x$, with red points showing measurements at the divisors of 500 (the \"characteristic scale\"). The dotted lines denote the true perimeter of the square. The left (a) and right (b) panels are ordinary and log-log plots, respectively."}

knitr::include_graphics(here::here("output/figure_example.pdf"))

```

# Power-law scaling of branching probability

Here, I reanalyze the data in @carraroOptimalChannelNetworks2022 to assess the scale invariance of branching probability. By definition, branching probability is said to be scale invariant if it follows a power law of observation scale $x$. Although the observation scale can take a variety of forms, a common metric in river geomorphology is the threshold value $A_T$ that defines the minimum watershed area of the river channel. Since $A_T$ measures stream size, we extract a subset of wider river channels as $A_T$ increases (Figure 2A and 2B); in other words, the resolution of the river network becomes coarser. I extracted river networks of $50$ watersheds that were used in Carraro and Altermatt with MERIT Hydro [@yamazakiMERITHydroHighresolution2019] (pixel size: $90~\text{m} \times 90~\text{m}$).

I used $20$ values of $A_T$ [km$^2$] ($A_T=1,...,1000$ with an equal interval at a $\log_{10}$ scale, but confined to $A_T < \text{total watershed area}$ for small rivers), at which I estimated branching probability. Branching probability $p$ [$\text{km}^{-1}$] is the probability of observing a joining tributary per unit river distance. This quantity can be estimated from the probability distribution of link length $L$ (i.e., the length of the river channel from one confluence to another, or one confluence to the outlet/upstream terminal). Typically, the link length $L$ follows an exponential distribution, and branching probability can be calculated as a cumulative distribution function of the exponential distribution [@teruiMetapopulationStabilityBranching2018; @teruiEmergentDualScaling2021]:

$$
\begin{aligned}
p = 1 - \exp(-\lambda)  &&\text{(4),}
\end{aligned}
$$

where $\lambda$ is the rate parameter of an exponential distribution, which approximates the inverse of mean link length [unit: $\text{km}^{-1}$] ($\lambda \approx N_L / \sum L$, $N_L$ is the number of links). To evaluate the power law of branching probability ($p \approx cA_T^z$), I fitted the following log-log linear model with robust regression:

$$
\begin{aligned}
\log_{10} p_{i} = \log_{10} c_{w(i)} + z\log_{10} A_{T,i} + \varepsilon_{i}  &&\text{(5),}
\end{aligned}
$$

where $p_i$ is the branching probability ($i$ represents a data point), $c_{w(i)}$ is the watershed-specific scaling constant ($w$ refers to a watershed), $z$ the scaling exponent, and $\varepsilon_i$ the error term that is properly weighted by Huber's function. I used robust regression analysis to account for outliers. Outliers were typical for coarse river networks with fewer links (i.e., large $A_T$ values) because the estimation accuracy of the mean link length $\lambda^{-1}$ depends on the number of links $N_L$. The analysis provided strong support for the power-law scaling of branching probability (Figure 2C) with the estimated scaling exponent of $z = -0.48 \pm 0.003$.

```{r fig-pr, fig.cap="(a and b) Examples of extracted river network (Eel River, US). In panel (a), a fine-resolution river network was extracted with $A_T = 12.7~\\text{km}^2$. In panel (b), a coarse river network was extracted with $A_T = 233.6~\\text{km}^2$. (c) Log-log plot substantiates the power-law scaling of branching probability $p$ along the axis of observation scale $A_T$. Colors indicate rivers highlighted in the original article [@carraroOptimalChannelNetworks2022]. Individual data points are shown in dots, whose transparency is proportional to the number of links $N_L$ (i.e., the sample size). Lines are predicted values from the robust regression model."}

knitr::include_graphics(here::here("output/figure_scaling.pdf"))

```

# Practical issues

It is noteworthy that the similar power-law scaling was reported in @carraroOptimalChannelNetworks2022 using the inverse of mean link length $\lambda$ (referred to as "branching ratio $p_r$" in the original article; see Figure 3a and Equation 1 in @carraroOptimalChannelNetworks2022). Nevertheless, the authors erroneously interpreted this result as a sign of "scale dependence." In addition, they used the term "scaling" as if it describes a property of scale dependence (page 3, right column). The misuse of the terms is not a simple issue of terminology. Based on their misconception, they expanded a discussion over two pages and concluded "*We therefore conclude that branching probability is a non-descriptive property of a river network, which by no means describes its inherent branching character, and depends on the observational scale*" (page 3). Hence, @carraroOptimalChannelNetworks2022 boldly used their misconception to invalidate past research that correctly referred to branching probability (or a cumulative distribution function of link length) as scale invariant [@peckhamReformulationHortonLaws1999; @rodriguez-iturbeFractalRiverBasins2001; @mooreEmergentStabilityLarge2015; @teruiMetapopulationStabilityBranching2018; @teruiEmergentDualScaling2021].

Along this line, @carraroOptimalChannelNetworks2022 also argued that branching probability does not represent river's branching character (page 3 to page 4, left column) because of the lack of characteristic scale (i.e., the unique value of branching probability does not exist for a given river network). This is clearly incorrect. We just need to perform a proper rescaling (or non-dimensionalization) to capture the structure of scale-invariant objects [@rodriguez-iturbeFractalRiverBasins2001]. Such rescaling is possible once the scaling equation is established:

$$
\begin{aligned}
p A_T^{-z} \approx c = constant &&\text{(6),}
\end{aligned}
$$

As evident from equation (6), we can obtain the unique value of (dimensionless) branching probability for a given river network after proper rescaling. This rescaling technique has been used for decades to characterize the physical/biological structure of scale invariant objects [@rodriguez-iturbeFractalRiverBasins2001; @brownMetabolicTheoryEcology2004; @rinaldoEvolutionSelectionRiver2014]. In fact, previous studies used a unit scale of $A_T$ ($A_T = 1~\text{km}^2$; notice that $p \approx c$ when $A_T = 1$) to approximate the rescaled branching probability [@teruiMetapopulationStabilityBranching2018; @teruiEmergentDualScaling2021]. As such, @carraroOptimalChannelNetworks2022 provided no evidence that limits the use of branching probability as a measure of river network structure.

Overall, it is clear that the authors fundamentally misunderstood the mathematical definition of scale invariance. Inappropriate arguments arising from the misconception spanned from page 2 to 4; thus, correcting this misconception compromises the substantial portion of their article.

# Distinct terminology in ecology

The misconception in @carraroOptimalChannelNetworks2022 may be rooted in the distinct use of the concerned terms in ecology. Although some ecologists follow the mathematical definitions [@hubbellUnifiedNeutralTheory2001; @brownFractalNatureNature2002; @brownMetabolicTheoryEcology2004], the majority of research uses the terms in stark contrast with fractal theory. At least, there are three types of contrast.

First, ecologists use scale invariance when the observation is scale dependent. This is common in food web ecology and dates back to at least the 1980s. In a pioneering work on food web properties, @briandCommunityFoodWebs1984 found no statistical trends in the proportion of basal and consumer species in a food web over a wide range of total species richness (i.e., the regression coefficient of total species richness was not significantly different from zero). Based on this finding, they concluded that food web properties are "scale invariant," as appeared in the article's title. The context shows that scale invariance in their article meant the constancy of the proportional abundance of certain trophic levels. Since then, this distinct terminology has been inherited in follow-up studies for approximately 40 years [@sugiharaScaleInvarianceFood1989; @bersierScaleInvariantScale1999; @galianaSpatialScalingFood2021]. For example, @galianaSpatialScalingFood2021 investigated food web properties across spatial scales and wrote:

> ...the proportion of species per trophic level and the proportion of overlap in the consumers’ diet were largely *scale-invariant* (Fig. 3). The proportion of basal, intermediate, and top species showed *similar values from local to regional spatial scales*... (emphasis added)

Clearly, scale invariance is used to describe food web properties that do not change from local to regional scales in a statistical sense; this is what is called "scale dependence" (or "non-scaling") in fractal theory. If truly scale invariant in a fractal sense, the food web properties should change according to the power law scaling of observation scale (species richness or area).

Second, ecologists use scale dependence when the observation is scale invariant. Spatial scaling of biodiversity, such as species-area relationships (SARs), exemplifies this situation. Species richness typically obeys a power-law function of area, a relationship currently known as the Arrhenius SAR [@arrheniusSpeciesArea1921]. This scaling feature enables us to predict species richness from small to large areas because a consistent "scaling law" exists across spatial scales. This property has contributed to the spatial design of aquatic and terrestrial protected areas [@neigelSpeciesareaRelationshipsMarine2003; @desmetUsingSpeciesareaRelationship2004], which encompass more
than 30 million km$^2$ globally [@deguignet2014UnitedNations2014]. Nevertheless, ecologists refer to such scaling relationships as scale-dependent [@palmerScaleDependenceSpeciesarea1994; @chaseEmbracingScaledependenceAchieve2018; @nishizawaLatitudinalGradientPlant2022] in contrast to the common terminology in fractal theory. Only a few ecologists refer to power-law SARs as scale invariant following the definition of fractal theory [e.g., @hubbellUnifiedNeutralTheory2001].

Lastly, ecologists use scaling when scaling is impossible. Countless numbers of ecological research use the term scaling when observations do not follow the scaling relationship defined in equation (3) [@jarzynaTaxonomicFunctionalDiversity2018; @keilSpatialScalingExtinction2018; @gonzalezScalingupBiodiversityecosystemFunctioning2020; @galianaSpatialScalingFood2021]. For example, @keilSpatialScalingExtinction2018 related species extirpation events to area and described the observed non-monotonic relationships as scaling; however, this is what is called "non-scaling" in fractal theory. The "ecological" use of scaling can be inferred from contexts if there is no mention to fractals or scaling theory. Yet, it is difficult to "adjust" the meaning of the term when some researchers discuss this ecological term of scaling with explicit reference to scaling theory [@gonzalezScalingupBiodiversityecosystemFunctioning2020], as scaling theory defines scaling in a completely opposite manner [@mandelbrotHowLongCoast1967; @rodriguez-iturbeFractalRiverBasins2001; @brownFractalNatureNature2002; @brownMetabolicTheoryEcology2004; @proektScaleInvarianceDynamics2012; @rinaldoEvolutionSelectionRiver2014]. Such a description is self-contradicting for those who have backgrounds in fractal/scaling theory.

The divergent use of the same terms among disciplines could be a natural outcome given the changing nature of language. One may argue that this is not a serious problem because "*people are skilled at deciphering meaning from context*" [@hodgesDefiningProblemTerminology2008]. I agree, but only if the central idea of the concept remains similar. For example, the term "metapopulation" is defined differently among studies [@hanskiMetapopulationDynamicsBrief1991; @poosImpactSpeciesspecificDispersal2012; @fronhoferWhyAreMetapopulations2012; @teruiMetapopulationStabilityBranching2018], but their "operational" definitions share the core of the concept. This is not the case with scale invariance. In ecology, scale invariance (and scaling) is used in a way that completely undermines the original theoretical implications of fractals. In an extreme case, researchers describe that a power function is an observation that does not satisfy scaling laws [@havensScaleStructureNatural1992]. It is likely that @carraroOptimalChannelNetworks2022 -- despite their clear focus on fractals -- picked this ecological conceptualization of "scale invariance" and "scaling" to invalidate past research that followed the mathematical definition of the same terms. An unsolved mystery, however, is that the authors followed the correct mathematical definitions in their previous publications [@giomettoScalingBodySize2013; @carraroGenerationApplicationRiver2020].

# Concluding remarks

Scaling is a fundamental property of scale-invariant observations, allowing for generalizations across different scales [@levinProblemPatternScale1992; @clarkGeneralStatisticalScaling2021]. This concept plays a central role in ecological research. However, the meanings of key terms have diverged within the field of ecology. In contrast, the same terms in fractal theory have retained their mathematically defined nature (equation (3) and Table 1) since their initial introduction in the 1960s [@mandelbrotHowLongCoast1967; @rodriguez-iturbeFractalRiverBasins2001; @brownFractalNatureNature2002; @brownMetabolicTheoryEcology2004; @proektScaleInvarianceDynamics2012; @rinaldoEvolutionSelectionRiver2014].

The gulf between ecology and fractal theory is deep, and achieving consistent terminology may prove challenging. As such, it is highly recommended that authors clarify the context of terminology in their research to promote better understanding. Simultaneously, it is crucial to encourage ecologists to recognize the mathematical definition of scale invariance. By fostering clearer communication and understanding between the fields, we can pave the way for more productive interdisciplinary collaborations. Otherwise, the divergent terminology creates unnecessary debates that hinder scientific advancement. The disrespectful arguments presented in @carraroOptimalChannelNetworks2022 serve as an unfortunate example of the negative consequences resulting from this divergence.

## Data availability

Codes and data are available at <https://github.com/aterui/public-proj_fractal-river>.

## Competing interest

None declared.

## Acknowledgements

I thank Ryosuke Iritani and Shota Shibasaki for their comments on the earlier version of this manuscript. This material is based upon work supported by the National Science Foundation through the Division of Environmental Biology (DEB 2015634).

\pagebreak

## References
