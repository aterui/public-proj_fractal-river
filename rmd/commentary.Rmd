---
title: "Mathematical characterization of fractal river networks"
output:
  bookdown::pdf_document2:
   latex_engine: xelatex
   toc: false
   number_sections: false
fontsize: 11pt
mainfont: "Times New Roman"
knit: (function(inputFile, encoding) {
        rmarkdown::render(inputFile,
                          encoding = encoding, 
                          output_dir = "document_output")
      })
bibliography: references.bib
csl: https://www.zotero.org/styles/population-ecology
header-includes:
  - \usepackage[left]{lineno}
  - \linenumbers
---

```{r setup, include=FALSE}

source(here::here("code/set_rmd.R"))
```

Author: Akira Terui^1,\*^

Email: hanabi0111\@gmail.com

^1^Department of Biology, University of North Carolina at Greensboro, Greensboro, NC 27410, USA

# Abstract

River networks exhibit fractal characteristics and unveiling the role of river fractals is important in understanding riverine ecological dynamics. Quantifying river network complexity is crucial, and researchers have used a metric of "branching probability" to do so. Previous studies showed that this metric reflects the fractal nature of river networks. However, a recent article by @carraroOptimalChannelNetworks2022 contradicted this classical observation and claimed that branching probability is "scale dependent." I dispute this claim and argues that their major conclusion is derived merely from their misconception of scale invariance. In fact, their analysis in the original article (Figure 3a) actually provided evidence that branching probability is scale invariant (i.e., branching probability exhibits a power-law scaling), although the authors erroneously interpreted this result as the sign of scale dependence. In this paper, I use this opportunity to address the widespread confusion about the term "scale invariance" in ecological literature and clarifies the definition of this concept. Specifically, I re-introduce the definition of scale invariance and show that branching probability meets this definition.

# Maintext

Rivers form complex branching networks with fractal characteristics -- "there are basins within basins within basins, all of them looking alike [@rinaldoEvolutionSelectionRiver2014]." The ecological implication of fractal structure has gained great interest over the past few decades [@grantLivingBranchesPopulation2007; @carraraDendriticConnectivityControls2012; @mariMetapopulationPersistenceSpecies2014], and there have been concerted efforts to investigate the role of river fractals in controlling metapopulation [@teruiMetapopulationStabilityBranching2018; @yeakelSynchronisationStabilityRiver2014; @mariMetapopulationPersistenceSpecies2014] and metacommunity dynamics [@teruiEmergentDualScaling2021; @carraraDendriticConnectivityControls2012; @andersonEffectsDispersalRiver2018]. The proper quantification of river network complexity is therefore crucial, and some researchers used a metric of "branching probability," i.e., the probability of observing a joining tributary per unit river distance [@yeakelSynchronisationStabilityRiver2014; @teruiMetapopulationStabilityBranching2018; @teruiEmergentDualScaling2021]. It has been shown that this measure reflects the fractal nature of river networks because it exhibits the sign of scale invariance [@peckhamReformulationHortonLaws1999; @teruiMetapopulationStabilityBranching2018; @rodriguez-iturbeFractalRiverBasins2001]. However, a recent article by @carraroOptimalChannelNetworks2022 countered this classical observation and concluded that branching probability is "scale dependent." They seriously criticized past research [@teruiMetapopulationStabilityBranching2018; @teruiEmergentDualScaling2021; @yeakelSynchronisationStabilityRiver2014; @andersonEffectsDispersalRiver2018] based on this observation, provocatively concluding "*an alleged property of such random networks (branching probability) is a scale dependent quantity that does not reflect any recognized metric of rivers' fractal character...*" Here, I would like to communicate my concern that this major conclusion in @carraroOptimalChannelNetworks2022 is simply a misconception of the term "scale invariance." Indeed, the reanalysis of their data proved that branching probability is scale invariant. In what follows, I re-introduce the definition of scale invariance and show that branching probability meets this definition.

# Premise: the definition of scale invariance

The concept of scale invariance is inherently confusing and is often misunderstood among ecologists. To clarify this concept, let me use the most famous example of a scale invariant object -- the complex structure of the coastline [@mandelbrotHowLongCoast1967]. In Mandelbrot's pioneering work, he measured the coastline length $y$ as multiples of a ruler with unit length $x$ (the "observation scale"). He observed that the length $y$ diverged to reach infinity as $x \rightarrow 0$, because finer but similar zig-zag patterns emerged over and over as he used a shorter ruler (Figure 1); that is, there was no specific scale that uniquely characterizes the coastline length (the "lack of characteristic scale"; Table 1). However, when the coastline length was expressed as a function of scale $x$ ($y = f(x)$), the function obeyed a simple rule that reflects the fractal nature of the observed object: the power law.

$$
\begin{aligned}
y = f(x) = cx^z &&\text{(1)}
\end{aligned}
$$

where $c$ is the scaling constant and $z$ is the scaling exponent. The scale invariance of this function can be easily proved by multiplying an arbitrary scaling factor $\lambda$:

$$
\begin{aligned}
y'=f(\lambda x)=c\lambda^zx^z = \lambda^z f(x) = \lambda^z y  &&\text{(2)}
\end{aligned}
$$

The above equation is interpreted as a sign of scale invariance because the multiplicative extension/shrink of scale $x$ by factor $\lambda$ results in the same shape of the original object $y$ but with a *different scale* [@proektScaleInvarianceDynamics2012] (i.e., the structural property or function is preserved). Hence, the observed object $y$ (= function $f(x)$) is said to be scale invariant.

Although a power law is the most famous example of scale invariance, any function $f(x)$ that suffices the following equation is said to be scale invariant [@rodriguez-iturbeFractalRiverBasins2001; @proektScaleInvarianceDynamics2012]:

$$
\begin{aligned}
f(\lambda x) = \lambda^z f(x) &&\text{(3)}
\end{aligned}
$$

A general property of this function is "scaling" (Table 1), in which the dimensional physical quantity of the object (e.g., length) changes predictably across scale $x$ [@rodriguez-iturbeFractalRiverBasins2001].

Conversely, a "scale dependent" object possesses contrasting properties (Table 1). A square exemplifies a scale dependent object. If we assume $500$ km on a side, the perimeter ($500 \times 4 =2000$ km) remains constant regardless of ruler length $x$ (assuming $2000$ is a divisible number of $x$; Figure 1). Therefore, the square has a characteristic scale that uniquely identifies its physical quantity. This property is called "non-scaling," which contrasts with the property of a scale invariant object [@rodriguez-iturbeFractalRiverBasins2001]. Although I used a square for the sake of simplicity, a more general definition of non-scaling is $f(\lambda x) \ne \lambda^zf(x)$. Thus, "scale dependence" and "scale invariance" are contrasting observations.

| Object type     | Property                                           |
|-----------------|----------------------------------------------------|
| Scale invariant | Scaling, the lack of characteristic scale          |
| Scale dependent | Non-scaling, the existence of characteristic scale |

: Key terminology

```{r example, echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=4, fig.cap="Graphical comparison of scale invariant and scale dependent objects. Black lines indicate an example of a scale invariant object (coastline), while gray lines show an example of a scale dependent object (perfect square). The left and right panels are ordinary and log-log plots, respectively."}

knitr::include_graphics(here::here("output/figure_example.pdf"))

```

# Power-law scaling of branching probability

Here, I reanalyze the data in @carraroOptimalChannelNetworks2022 to assess the scale invariance of branching probability. By definition, branching probability is said to be scale invariant if it follows a power law of observation scale $x$. Although the observation scale can take a variety of forms, a common metric in river geomorphology is the threshold value $A_T$ that defines the minimum watershed area of the river channel. Since $A_T$ measures stream size, we extract a subset of larger river channels as $A_T$ increases (Figure 2A and 2B); in other words, the resolution of the river network becomes coarser. I extracted river networks of $50$ watersheds that were used in Carraro and Altermatt with MERIT Hydro [@yamazakiMERITHydroHighresolution2019] (pixel size: $90~\text{m} \times 90~\text{m}$). I used $20$ values of $A_T$ [km$^2$] ($A_T=1,...,1000$ with an equal interval at a $\log_{10}$ scale, but confined to $A_T < \text{total watershed area}$ for small rivers), at which I estimated branching probability. Branching probability $p$ [$\text{km}^{-1}$] is the probability of observing a joining tributary per unit river distance. This quantity can be estimated from the probability distribution of link length $L$ (i.e., the length of the river channel from one confluence to another, or one confluence to the outlet/upstream terminal) [@teruiMetapopulationStabilityBranching2018; @teruiEmergentDualScaling2021]:

$$
\begin{aligned}
p = 1 - \exp(-\lambda)  &&\text{(4)}
\end{aligned}
$$

where $\lambda$ is the inverse of mean link length [unit: $\text{km}^{-1}$] ($\lambda = N_L / \sum L$, $N_L$ is the number of links). To evaluate the power law of branching probability ($p \approx cA_T^z$), I fitted the following log-log linear model with robust regression:

$$
\begin{aligned}
\log_{10} p_{i} = \log_{10} c_{w(i)} + z\log_{10} A_{T,i} + \varepsilon_{i}  &&\text{(5)}
\end{aligned}
$$

where $p_i$ is the branching probability ($i$ represents a data point), $c_{w(i)}$ is the watershed-specific scaling constant ($w$ refers to a watershed), $z$ the scaling exponent, and $\varepsilon_i$ the error term that is properly weighted by Huber's function. I used robust regression analysis to account for outliers. Outliers were typical for coarse river networks with fewer links (i.e., large $A_T$ values) because the estimation accuracy of the mean link length $\lambda^{-1}$ depends on the number of links $N_L$.

The analysis provided strong support for the power-law scaling of branching probability (Figure 2C) with the estimated scaling exponent of $z = -0.48 \pm 0.003$. Note that the similar power-law scaling was reported in @carraroOptimalChannelNetworks2022 using the inverse of mean link length $\lambda$ (referred to as "branching ratio $p_r$" in the original article; see Figure 3 and Equation 1 in @carraroOptimalChannelNetworks2022), although the authors erroneously interpreted this result as a sign of "scale dependence."

```{r fig-pr, fig.cap="(A and B) Examples of extracted river network (Eel River, US). In panel A, a fine-resolution river network was extracted with $A_T = 1~\\text{km}^2$. In panel B, a coarse river network was extracted with $A_T = 112.9~\\text{km}^2$. (C) Log-log plot substantiates the power-law scaling of branching probability $p$ along the axis of observation scale $A_T$. Colors indicate rivers highlighted in the original article [@carraroOptimalChannelNetworks2022]. Individual data points are shown in dots, whose transparency is proportional to the number of links $N_L$ (i.e., the sample size). Lines are predicted values from the robust regression model."}

knitr::include_graphics(here::here("output/figure_scaling.pdf"))

```

# Concluding remarks

The reanalysis showed that branching probability is scale invariant, reflecting the fractal nature of river networks. Notably, the original research yielded the same result [@carraroOptimalChannelNetworks2022], yet they derived a contrasting conclusion that branching probability is scale dependent. From this observation, it is highly likely that the authors fundamentally misunderstood the definition of scale invariance and unfairly criticized past research that followed the formal definition of scale invariance.

Scale invariance is not unique to rivers [@brownFractalNatureNature2002]. It is observed in predator-prey interactions [@hattonPredatorpreyPowerLaw2015], biological metabolism [@brownMetabolicTheoryEcology2004], food chain length [@saboRoleDischargeVariation2010], and species-area relationship [@hubbellUnifiedNeutralTheory2001], to name just a few. Therefore, this concept is central to ecological research, and effective communications rely on its proper use. While @carraroOptimalChannelNetworks2022 provided important insights, their bold claim must have been made based on the appropriate understanding of the key concept. Otherwise, it introduces unnecessary debates that hinder the progress of this research field.

## Data availability

Codes and data are available at <https://github.com/aterui/public-proj_fractal-river>.

## Competing interest

None declared.

## Acknowledgements

I thank Ryosuke Iritani for his comments on the earlier version of this manuscript. This material is based upon work supported by the National Science Foundation through the Division of Environmental Biology (DEB 2015634).

\pagebreak

## References
